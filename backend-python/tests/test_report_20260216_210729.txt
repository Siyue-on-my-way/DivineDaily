================================================================================
DivineDaily 测试报告
================================================================================

测试时间: 2026-02-16 21:07:29
总测试套件: 3
通过: 0
失败: 3
通过率: 0%

详细结果:

基础功能测试: 失败
--------------------------------------------------------------------------------
============================================================
开始运行重启后测试用例
============================================================
测试 1: 用户登录...
✅ 登录测试通过

测试 2: 获取 LLM 配置列表...
✅ LLM 配置列表测试通过 (共 1 个配置)

测试 3: 获取 Assistant 配置列表...
✅ Assistant 配置列表测试通过 (共 4 个配置)

测试 4: LLM 测试接口...
✅ LLM 测试接口通过 (success=True)

测试 5: 获取 Assistant 测试用例...
✅ Assistant 测试用例获取通过 (共 4 个用例)

测试 6: Assistant 测试接口...
✅ Assistant 测试接口通过 (success=True)

测试 7: 占卜开始接口...
❌ 占卜开始接口失败: 占卜开始失败: 500 - {"detail":"占卜失败: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation \"question_intents\" does not exist\n[SQL: INSERT INTO question_intents (user_id, original_question, intent_type, confidence, category, subcategory, enhanced_question, keywords, context) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::JSON, $9::JSON) RETURNING question_intents.id, question_intents.created_at]\n[parameters: ('1', '我今年的官运如何', '财运', 30, 'iching', 'fortune', '关于我今年的官运如何的问题', '[\"\\\\u4eca\\\\u5e74\"]', '{}')]\n(Background on this error at: https://sqlalche.me/e/20/f405) (Background on this error at: https://sqlalche.me/e/20/7s2a)"}

============================================================
测试结果汇总
============================================================
用户登录: ✅ 通过
LLM 配置列表: ✅ 通过
Assistant 配置列表: ✅ 通过
LLM 测试接口: ✅ 通过
Assistant 测试用例: ✅ 通过
Assistant 测试接口: ✅ 通过
占卜开始接口: ❌ 失败

总计: 6/7 通过
============================================================


用户端完整测试: 失败
--------------------------------------------------------------------------------

================================================================================
  DivineDaily 综合测试套件
  测试时间: 2026-02-16 21:06:58
================================================================================

================================================================================
  用户端测试流程
================================================================================

🧪 测试: 用户注册
   ❌ 用户注册 - 状态码错误: 期望 201, 实际 422
   ❌ 响应内容: {"detail":[{"type":"missing","loc":["body","username"],"msg":"Field required","input":{"email":"test_1771247218@example.com","password":"test123456","nickname":"测试用户"},"url":"https://errors.pydantic.d

🧪 测试: 用户登录
   ❌ 用户登录 - 状态码错误: 期望 200, 实际 401
   ❌ 响应内容: {"detail":"用户名或密码错误"}

🧪 测试: 获取当前用户信息
   ❌ 获取用户信息 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 创建用户档案
   ❌ 创建档案 - 状态码错误: 期望 200, 实际 404
   ❌ 响应内容: {"detail":"Not Found"}

🧪 测试: 获取用户档案
   ❌ 获取档案 - 状态码错误: 期望 200, 实际 404
   ❌ 响应内容: {"detail":"Not Found"}

🧪 测试: 周易占卜 - 决策类问题
   ❌ 周易占卜 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 周易占卜 - 运势类问题
   ❌ 运势占卜 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 塔罗占卜 - 单张牌
   ❌ 塔罗单张 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 塔罗占卜 - 三张牌阵
   ❌ 塔罗三张 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 塔罗占卜 - 十字牌阵
   ❌ 塔罗十字 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 每日运势 - 今日
   ❌ 每日运势 - 缺少字段: score

🧪 测试: 获取占卜历史
   ❌ 历史记录 - 状态码错误: 期望 200, 实际 403
   ❌ 响应内容: {"detail":"Not authenticated"}

🧪 测试: 获取单个占卜结果
   ℹ️  跳过 - 没有可用的session_id

================================================================================
  测试结果汇总
================================================================================
用户注册                           ❌ 失败
用户登录                           ❌ 失败
获取用户信息                         ❌ 失败
创建用户档案                         ❌ 失败
获取用户档案                         ❌ 失败
周易占卜-决策                        ❌ 失败
周易占卜-运势                        ❌ 失败
塔罗占卜-单张                        ❌ 失败
塔罗占卜-三张                        ❌ 失败
塔罗占卜-十字                        ❌ 失败
每日运势                           ❌ 失败
占卜历史                           ❌ 失败
单个结果                           ✅ 通过

总计: 1/13 通过 (7%)

⚠️  有 12 个测试失败


管理端完整测试: 失败
--------------------------------------------------------------------------------

================================================================================
  DivineDaily 管理端测试套件
  测试时间: 2026-02-16 21:06:58
================================================================================

================================================================================
  管理端测试流程
================================================================================

🧪 测试: 管理员登录
   ✅ 管理员登录成功

🧪 测试: 获取LLM配置列表
   ✅ 获取成功 - 共 1 个配置
   ℹ️    - novalAI-claude-opus-4-5-20251101 (openai/claude-opus-4-5-20251101)

🧪 测试: 创建LLM配置
   ✅ 创建成功 - ID: 4, 名称: 测试LLM_1771247219

🧪 测试: 更新LLM配置
   ✅ 更新成功

🧪 测试: 测试LLM配置
   ✅ LLM测试成功
   ℹ️  响应: 你好！我是Claude，由Anthropic开发的AI助手，致力于提供有帮助、准确且安全的对话服务。...

🧪 测试: 删除LLM配置
   ✅ 删除成功

🧪 测试: 获取Assistant配置列表
   ✅ 获取成功 - 共 4 个配置
   ℹ️    - 易经-详情 (divination/detail)
   ℹ️    - 易经-结果卡-测试 (divination/answer)
   ℹ️    - 塔罗牌-详情 (tarot/detail)

🧪 测试: 创建Assistant配置
   ❌ 创建Assistant配置 - 状态码错误: 期望 200, 实际 500
   ❌ 响应: Internal Server Error

🧪 测试: 更新Assistant配置
   ℹ️  跳过 - 没有可用的配置ID

🧪 测试: 获取测试用例
   ✅ 获取成功 - 共 4 个测试用例

🧪 测试: 测试Assistant配置
   ✅ Assistant测试成功
   ℹ️  关键词匹配: 3/4

🧪 测试: 删除Assistant配置
   ℹ️  跳过 - 没有可用的配置ID

================================================================================
  测试结果汇总
================================================================================
管理员登录                          ✅ 通过
获取LLM配置列表                      ✅ 通过
创建LLM配置                        ✅ 通过
更新LLM配置                        ✅ 通过
测试LLM配置                        ✅ 通过
删除LLM配置                        ✅ 通过
获取Assistant配置列表                ✅ 通过
创建Assistant配置                  ❌ 失败
更新Assistant配置                  ✅ 通过
获取测试用例                         ✅ 通过
测试Assistant配置                  ✅ 通过
删除Assistant配置                  ✅ 通过

总计: 11/12 通过 (91%)

⚠️  有 1 个测试失败

